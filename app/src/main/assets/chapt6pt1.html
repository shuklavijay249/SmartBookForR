<div class="devsite-article-body clearfix
              devsite-no-page-title
        ">&nbsp;</div>
<div>
<h1 id="mediaplayer-overview" class="" style="text-align: justify;">MediaPlayer overview</h1>
<div class="devsite-article-body clearfix
      ">
<p style="text-align: justify;">The Android multimedia framework includes support for playing variety of common media types, so that you can easily integrate audio, video and images into your applications. You can play audio or video from media files stored in your application's resources (raw resources), from standalone files in the filesystem, or from a data stream arriving over a network connection, all using&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;APIs.</p>
<p style="text-align: justify;">This document shows you how to write a media-playing application that interacts with the user and the system in order to obtain good performance and a pleasant user experience.</p>
<p class="note" style="text-align: justify;"><strong>Note:</strong>&nbsp;You can play back the audio data only to the standard output device. Currently, that is the mobile device speaker or a Bluetooth headset. You cannot play sound files in the conversation audio during a call.</p>
<h2 id="basics" style="text-align: justify;">The basics<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h2>
<p style="text-align: justify;">The following classes are used to play sound and video in the Android framework:</p>
<dl>
<dt><code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code></dt>
<dd>This class is the primary API for playing sound and video.</dd>
<dt><code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/AudioManager.html">AudioManager</a></code></dt>
<dd>This class manages audio sources and audio output on a device.</dd>
</dl>
<h2 id="manifest" style="text-align: justify;">Manifest declarations<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h2>
<p style="text-align: justify;">Before starting development on your application using MediaPlayer, make sure your manifest has the appropriate declarations to allow use of related features.</p>
<ul style="text-align: justify;">
<li><strong>Internet Permission</strong>&nbsp;- If you are using MediaPlayer to stream network-based content, your application must request network access.
<pre class="lang-xml" dir="ltr" translate="no"><span class="tag">&lt;uses-permission</span> <span class="atn">android:name</span><span class="pun">=</span><span class="atv">"android.permission.INTERNET"</span> <span class="tag">/&gt;</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</li>
<li><strong>Wake Lock Permission</strong>&nbsp;- If your player application needs to keep the screen from dimming or the processor from sleeping, or uses the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setScreenOnWhilePlaying(boolean)">MediaPlayer.setScreenOnWhilePlaying()</a></code>&nbsp;or<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setWakeMode(android.content.Context,%20int)">MediaPlayer.setWakeMode()</a></code>&nbsp;methods, you must request this permission.
<pre class="lang-xml" dir="ltr" translate="no"><span class="tag">&lt;uses-permission</span> <span class="atn">android:name</span><span class="pun">=</span><span class="atv">"android.permission.WAKE_LOCK"</span> <span class="tag">/&gt;</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</li>
</ul>
<h2 id="mediaplayer" style="text-align: justify;">Using MediaPlayer<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h2>
<p style="text-align: justify;">One of the most important components of the media framework is the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;class. An object of this class can fetch, decode, and play both audio and video with minimal setup. It supports several different media sources such as:</p>
<ul style="text-align: justify;">
<li>Local resources</li>
<li>Internal URIs, such as one you might obtain from a Content Resolver</li>
<li>External URLs (streaming)</li>
</ul>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: justify;">For a list of media formats that Android supports, see the&nbsp;<a href="https://developer.android.com/guide/topics/media/media-formats.html">Supported Media Formats</a>&nbsp;page.</p>
<p style="text-align: justify;">Here is an example of how to play audio that's available as a local raw resource (saved in your application's<code dir="ltr" translate="no">res/raw/</code>&nbsp;directory):</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer </span><span class="pun">=</span> <span class="typ">MediaPlayer</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> R</span><span class="pun">.</span><span class="pln">raw</span><span class="pun">.</span><span class="pln">sound_file_1</span><span class="pun">);</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span> <span class="com">// no need to call prepare(); create() does that for you</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p style="text-align: justify;">In this case, a "raw" resource is a file that the system does not try to parse in any particular way. However, the content of this resource should not be raw audio. It should be a properly encoded and formatted media file in one of the supported formats.</p>
<p style="text-align: justify;">And here is how you might play from a URI available locally in the system (that you obtained through a Content Resolver, for instance):</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="typ">Uri</span><span class="pln"> myUri </span><span class="pun">=</span> <span class="pun">....;</span> <span class="com">// initialize Uri here</span><span class="pln"><br /></span><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer </span><span class="pun">=</span> <span class="kwd">new</span> <span class="typ">MediaPlayer</span><span class="pun">();</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">setAudioStreamType</span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">);</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> myUri</span><span class="pun">);</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">prepare</span><span class="pun">();</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p style="text-align: justify;">Playing from a remote URL via HTTP streaming looks like this:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="typ">String</span><span class="pln"> url </span><span class="pun">=</span> <span class="str">"http://........"</span><span class="pun">;</span> <span class="com">// your URL here</span><span class="pln"><br /></span><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer </span><span class="pun">=</span> <span class="kwd">new</span> <span class="typ">MediaPlayer</span><span class="pun">();</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">setAudioStreamType</span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">);</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span class="pln">url</span><span class="pun">);</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">prepare</span><span class="pun">();</span> <span class="com">// might take long! (for buffering, etc)</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p class="note" style="text-align: justify;"><strong>Note:</strong>&nbsp;If you're passing a URL to stream an online media file, the file must be capable of progressive download.</p>
<p class="caution" style="text-align: justify;"><strong>Caution:</strong>&nbsp;You must either catch or pass&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/java/lang/IllegalArgumentException.html">IllegalArgumentException</a></code>&nbsp;and&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/java/io/IOException.html">IOException</a></code>&nbsp;when using<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setDataSource(android.content.Context,%20android.net.Uri)">setDataSource()</a></code>, because the file you are referencing might not exist.</p>
<h3 id="preparingasync" style="text-align: justify;">Asynchronous preparation<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">Using&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;can be straightforward in principle. However, it's important to keep in mind that a few more things are necessary to integrate it correctly with a typical Android application. For example, the call to&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepare()">prepare()</a></code>&nbsp;can take a long time to execute, because it might involve fetching and decoding media data. So, as is the case with any method that may take long to execute, you should&nbsp;<strong>never call it from your application's UI thread</strong>. Doing that causes the UI to hang until the method returns, which is a very bad user experience and can cause an ANR (Application Not Responding) error. Even if you expect your resource to load quickly, remember that anything that takes more than a tenth of a second to respond in the UI causes a noticeable pause and gives the user the impression that your application is slow.</p>
<p style="text-align: justify;">To avoid hanging your UI thread, spawn another thread to prepare the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;and notify the main thread when done. However, while you could write the threading logic yourself, this pattern is so common when using&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;that the framework supplies a convenient way to accomplish this task by using the<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()">prepareAsync()</a></code>&nbsp;method. This method starts preparing the media in the background and returns immediately. When the media is done preparing, the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html#onPrepared(android.media.MediaPlayer)">onPrepared()</a></code>&nbsp;method of the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html">MediaPlayer.OnPreparedListener</a></code>, configured through&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setOnPreparedListener(android.media.MediaPlayer.OnPreparedListener)">setOnPreparedListener()</a></code>&nbsp;is called.</p>
<h3 id="managestate" style="text-align: justify;">Managing state<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">Another aspect of a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;that you should keep in mind is that it's state-based. That is, the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;has an internal state that you must always be aware of when writing your code, because certain operations are only valid when then player is in specific states. If you perform an operation while in the wrong state, the system may throw an exception or cause other undesirable behaviors.</p>
<p style="text-align: justify;">The documentation in the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;class shows a complete state diagram, that clarifies which methods move the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;from one state to another. For example, when you create a new&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>, it is in the&nbsp;<em>Idle</em>&nbsp;state. At that point, you should initialize it by calling&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setDataSource(android.content.Context,%20android.net.Uri)">setDataSource()</a></code>, bringing it to the&nbsp;<em>Initialized</em>state. After that, you have to prepare it using either the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepare()">prepare()</a></code>&nbsp;or&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()">prepareAsync()</a></code>&nbsp;method. When the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;is done preparing, it enters the&nbsp;<em>Prepared</em>&nbsp;state, which means you can call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#start()">start()</a></code>&nbsp;to make it play the media. At that point, as the diagram illustrates, you can move between the&nbsp;<em>Started</em>,&nbsp;<em>Paused</em>&nbsp;and&nbsp;<em>PlaybackCompleted</em>&nbsp;states by calling such methods as&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#start()">start()</a></code>,&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#pause()">pause()</a></code>, and&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#seekTo(int)">seekTo()</a></code>, amongst others. When you call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#stop()">stop()</a></code>, however, notice that you cannot call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#start()">start()</a></code>&nbsp;again until you prepare the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;again.</p>
<p style="text-align: justify;">Always keep&nbsp;<a href="https://developer.android.com/images/mediaplayer_state_diagram.gif">the state diagram</a>&nbsp;in mind when writing code that interacts with a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;object, because calling its methods from the wrong state is a common cause of bugs.</p>
<h3 id="releaseplayer" style="text-align: justify;">Releasing the MediaPlayer<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">A&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;can consume valuable system resources. Therefore, you should always take extra precautions to make sure you are not hanging on to a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;instance longer than necessary. When you are done with it, you should always call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#release()">release()</a></code>&nbsp;to make sure any system resources allocated to it are properly released. For example, if you are using a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;and your activity receives a call to&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/app/Activity.html#onStop()">onStop()</a></code>, you must release the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>, because it makes little sense to hold on to it while your activity is not interacting with the user (unless you are playing media in the background, which is discussed in the next section). When your activity is resumed or restarted, of course, you need to create a new&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;and prepare it again before resuming playback.</p>
<p style="text-align: justify;">Here's how you should release and then nullify your&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="pln">mediaPlayer</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln"><br />mediaPlayer </span><span class="pun">=</span> <span class="kwd">null</span><span class="pun">;</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p style="text-align: justify;">As an example, consider the problems that could happen if you forgot to release the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;when your activity is stopped, but create a new one when the activity starts again. As you may know, when the user changes the screen orientation (or changes the device configuration in another way), the system handles that by restarting the activity (by default), so you might quickly consume all of the system resources as the user rotates the device back and forth between portrait and landscape, because at each orientation change, you create a new&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;that you never release. (For more information about runtime restarts, see&nbsp;<a href="https://developer.android.com/guide/topics/resources/runtime-changes.html">Handling Runtime Changes</a>.)</p>
<p style="text-align: justify;">You may be wondering what happens if you want to continue playing "background media" even when the user leaves your activity, much in the same way that the built-in Music application behaves. In this case, what you need is a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;controlled by a Service, as discussed in the next section</p>
<h2 id="mpandservices" style="text-align: justify;">Using MediaPlayer in a service<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h2>
<p style="text-align: justify;">If you want your media to play in the background even when your application is not onscreen&mdash;that is, you want it to continue playing while the user is interacting with other applications&mdash;then you must start a Service and control the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;instance from there. You need to embed the MediaPlayer in a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/androidx/media/MediaBrowserServiceCompat.html">MediaBrowserServiceCompat</a></code>&nbsp;service and have it interact with a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/support/v4/media/MediaBrowserCompat.html">MediaBrowserCompat</a></code>&nbsp;in another activity.</p>
<p style="text-align: justify;">You should be careful about this client/server setup. There are expectations about how a player running in a background service interacts with the rest of the system. If your application does not fulfill those expectations, the user may have a bad experience. Read&nbsp;<a href="https://developer.android.com/guide/topics/media-apps/audio-app/building-an-audio-app.html">Building an Audio App</a>&nbsp;for the full details.</p>
<p style="text-align: justify;">This section describes special instructions for managing a MediaPlayer when it is implemented inside a service.</p>
<h3 id="asyncprepare" style="text-align: justify;">Running asynchronously<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">First of all, like an&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/app/Activity.html">Activity</a></code>, all work in a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/app/Service.html">Service</a></code>&nbsp;is done in a single thread by default&mdash;in fact, if you're running an activity and a service from the same application, they use the same thread (the "main thread") by default. Therefore, services need to process incoming intents quickly and never perform lengthy computations when responding to them. If any heavy work or blocking calls are expected, you must do those tasks asynchronously: either from another thread you implement yourself, or using the framework's many facilities for asynchronous processing.</p>
<p style="text-align: justify;">For instance, when using a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;from your main thread, you should call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()">prepareAsync()</a></code>&nbsp;rather than<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepare()">prepare()</a></code>, and implement a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html">MediaPlayer.OnPreparedListener</a></code>&nbsp;in order to be notified when the preparation is complete and you can start playing. For example:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="kwd">public</span> <span class="kwd">class</span> <span class="typ">MyService</span> <span class="kwd">extends</span> <span class="typ">Service</span> <span class="kwd">implements</span> <span class="typ">MediaPlayer</span><span class="pun">.</span><span class="typ">OnPreparedListener</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">private</span> <span class="kwd">static</span> <span class="kwd">final</span> <span class="typ">String</span><span class="pln"> ACTION_PLAY </span><span class="pun">=</span> <span class="str">"com.example.action.PLAY"</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer </span><span class="pun">=</span> <span class="kwd">null</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="kwd">public</span> <span class="kwd">int</span><span class="pln"> onStartCommand</span><span class="pun">(</span><span class="typ">Intent</span><span class="pln"> intent</span><span class="pun">,</span> <span class="kwd">int</span><span class="pln"> flags</span><span class="pun">,</span> <span class="kwd">int</span><span class="pln"> startId</span><span class="pun">)</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">...</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span> <span class="pun">(</span><span class="pln">intent</span><span class="pun">.</span><span class="pln">getAction</span><span class="pun">().</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">ACTION_PLAY</span><span class="pun">))</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mediaPlayer </span><span class="pun">=</span> <span class="pun">...</span> <span class="com">// initialize it here</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mediaPlayer</span><span class="pun">.</span><span class="pln">setOnPreparedListener</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mediaPlayer</span><span class="pun">.</span><span class="pln">prepareAsync</span><span class="pun">();</span> <span class="com">// prepare async to not block main thread</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="com">/** Called when MediaPlayer is ready */</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">public</span> <span class="kwd">void</span><span class="pln"> onPrepared</span><span class="pun">(</span><span class="typ">MediaPlayer</span><span class="pln"> player</span><span class="pun">)</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; player</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<h3 id="asyncerror" style="text-align: justify;">Handling asynchronous errors<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">On synchronous operations, errors would normally be signaled with an exception or an error code, but whenever you use asynchronous resources, you should make sure your application is notified of errors appropriately. In the case of a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>, you can accomplish this by implementing a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnErrorListener.html">MediaPlayer.OnErrorListener</a></code>&nbsp;and setting it in your&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;instance:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="kwd">public</span> <span class="kwd">class</span> <span class="typ">MyService</span> <span class="kwd">extends</span> <span class="typ">Service</span> <span class="kwd">implements</span> <span class="typ">MediaPlayer</span><span class="pun">.</span><span class="typ">OnErrorListener</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="kwd">public</span> <span class="kwd">void</span><span class="pln"> initMediaPlayer</span><span class="pun">()</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// ...initialize the MediaPlayer here...</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; mediaPlayer</span><span class="pun">.</span><span class="pln">setOnErrorListener</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="lit">@Override</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">public</span> <span class="kwd">boolean</span><span class="pln"> onError</span><span class="pun">(</span><span class="typ">MediaPlayer</span><span class="pln"> mp</span><span class="pun">,</span> <span class="kwd">int</span><span class="pln"> what</span><span class="pun">,</span> <span class="kwd">int</span><span class="pln"> extra</span><span class="pun">)</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// ... react appropriately ...</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// The MediaPlayer has moved to the Error state, must be reset!</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p style="text-align: justify;">It's important to remember that when an error occurs, the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;moves to the&nbsp;<em>Error</em>&nbsp;state (see the documentation for the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;class for the full state diagram) and you must reset it before you can use it again.</p>
<h3 id="wakelocks" style="text-align: justify;">Using wake locks<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">When designing applications that play media in the background, the device may go to sleep while your service is running. Because the Android system tries to conserve battery while the device is sleeping, the system tries to shut off any of the phone's features that are not necessary, including the CPU and the WiFi hardware. However, if your service is playing or streaming music, you want to prevent the system from interfering with your playback.</p>
<p style="text-align: justify;">In order to ensure that your service continues to run under those conditions, you have to use "wake locks." A wake lock is a way to signal to the system that your application is using some feature that should stay available even if the phone is idle.</p>
<p class="caution" style="text-align: justify;"><strong>Notice:</strong>&nbsp;You should always use wake locks sparingly and hold them only for as long as truly necessary, because they significantly reduce the battery life of the device.</p>
<p style="text-align: justify;">To ensure that the CPU continues running while your&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;is playing, call the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setWakeMode(android.content.Context,%20int)">setWakeMode()</a></code>&nbsp;method when initializing your&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>. Once you do, the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;holds the specified lock while playing and releases the lock when paused or stopped:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="pln">mediaPlayer </span><span class="pun">=</span> <span class="kwd">new</span> <span class="typ">MediaPlayer</span><span class="pun">();</span><span class="pln"><br /></span><span class="com">// ... other initialization here ...</span><span class="pln"><br /></span>&nbsp;</pre>
</section>
</div>
<p style="text-align: justify;">However, the wake lock acquired in this example guarantees only that the CPU remains awake. If you are streaming media over the network and you are using Wi-Fi, you probably want to hold a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/net/wifi/WifiManager.WifiLock.html">WifiLock</a></code>&nbsp;as well, which you must acquire and release manually. So, when you start preparing the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;with the remote URL, you should create and acquire the Wi-Fi lock. For example:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="typ">WifiLock</span><span class="pln"> wifiLock </span><span class="pun">=</span> <span class="pun">((</span><span class="typ">WifiManager</span><span class="pun">)</span><span class="pln"> getSystemService<br /></span><span class="pun">(</span><span class="typ">Context</span><span class="pun">.</span><span class="pln">WIFI_SERVICE</span><span class="pun">))</span><span class="pun">.</span><span class="pln">createWifiLock</span><span class="pun">(</span><span class="typ">WifiManager</span><span class="pun">.<br /></span><span class="pln">WIFI_MODE_FULL</span><span class="pun">,</span> <span class="str">"mylock"</span><span class="pun">);</span><span class="pln"><br /><br />wifiLock</span><span class="pun">.</span><span class="pln">acquire</span><span class="pun">();</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p style="text-align: justify;">When you pause or stop your media, or when you no longer need the network, you should release the lock:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="pln">wifiLock</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<h3 id="cleanup" style="text-align: justify;">Performing cleanup<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">As mentioned earlier, a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;object can consume a significant amount of system resources, so you should keep it only for as long as you need and call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#release()">release()</a></code>&nbsp;when you are done with it. It's important to call this cleanup method explicitly rather than rely on system garbage collection because it might take some time before the garbage collector reclaims the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>, as it's only sensitive to memory needs and not to shortage of other media-related resources. So, in the case when you're using a service, you should always override the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/app/Service.html#onDestroy()">onDestroy()</a></code>&nbsp;method to make sure you are releasing the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="kwd">public</span> <span class="kwd">class</span> <span class="typ">MyService</span> <span class="kwd">extends</span> <span class="typ">Service</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp;</span><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp;</span><span class="com">// ...</span><span class="pln"><br /><br />&nbsp; &nbsp;</span><span class="lit">@Override</span><span class="pln"><br />&nbsp; &nbsp;</span><span class="kwd">public</span> <span class="kwd">void</span><span class="pln"> onDestroy</span><span class="pun">()</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onDestroy</span><span class="pun">()</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">if</span> <span class="pun">(</span><span class="pln">mediaPlayer </span><span class="pun">!=</span> <span class="kwd">null</span><span class="pun">)</span><span class="pln"> mediaPlayer</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln"><br />&nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p style="text-align: justify;">You should always look for other opportunities to release your&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;as well, apart from releasing it when being shut down. For example, if you expect not to be able to play media for an extended period of time (after losing audio focus, for example), you should definitely release your existing&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;and create it again later. On the other hand, if you only expect to stop playback for a very short time, you should probably hold on to your&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;to avoid the overhead of creating and preparing it again.</p>
<h2 id="drm" style="text-align: justify;">Digital Rights Management (DRM)<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h2>
<p style="text-align: justify;">Starting with Android 8.0 (API level 26),&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;includes APIs that support the playback of DRM-protected material. They are similar to the low-level API provided by&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaDrm.html">MediaDrm</a></code>, but they operate at a higher level and do not expose the underlying extractor, drm, and crypto objects.</p>
<p style="text-align: justify;">Although the MediaPlayer DRM API does not provide the full functionality of&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaDrm.html">MediaDrm</a></code>, it supports the most common use cases. The current implementation can handle the following content types:</p>
<ul style="text-align: justify;">
<li>Widevine-protected local media files</li>
<li>Widevine-protected remote/streaming media files</li>
</ul>
<p style="text-align: justify;">The following code snippet demonstrates how to use the new DRM MediaPlayer methods in a simple synchronous implementation.</p>
<p style="text-align: justify;">To manage DRM-controlled media, you need to include the new methods alongside the usual flow of MediaPlayer calls, as shown below:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="pln">setDataSource</span><span class="pun">();</span><span class="pln"><br />setOnDrmConfigHelper</span><span class="pun">();</span> <span class="com">// optional, for custom configuration</span><span class="pln"><br />prepare</span><span class="pun">();</span><span class="pln"><br /></span><span class="kwd">if</span> <span class="pun">(</span><span class="pln">getDrmInfo</span><span class="pun">()</span> <span class="pun">!=</span> <span class="kwd">null</span><span class="pun">)</span> <span class="pun">{</span><span class="pln"><br />&nbsp; prepareDrm</span><span class="pun">();</span><span class="pln"><br />&nbsp; getKeyRequest</span><span class="pun">();</span><span class="pln"><br />&nbsp; provideKeyResponse</span><span class="pun">();</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /><br /></span><span class="com">// MediaPlayer is now ready to use</span><span class="pln"><br />start</span><span class="pun">();</span><span class="pln"><br /></span><span class="com">// ...play/pause/resume...</span><span class="pln"><br />stop</span><span class="pun">();</span><span class="pln"><br />releaseDrm</span><span class="pun">();</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p style="text-align: justify;">Start by initializing the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>&nbsp;object and setting its source using&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setDataSource(android.content.Context,%20android.net.Uri)">setDataSource()</a></code>, as usual. Then, to use DRM, perform these steps:</p>
<ol style="text-align: justify;">
<li>If you want your app to perform custom configuration, define an&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnDrmConfigHelper.html">OnDrmConfigHelper</a></code>&nbsp;interface, and attach it to the player using&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setOnDrmConfigHelper(android.media.MediaPlayer.OnDrmConfigHelper)">setOnDrmConfigHelper()</a></code>.</li>
<li>Call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepare()">prepare()</a></code>.</li>
<li>Call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#getDrmInfo()">getDrmInfo()</a></code>. If the source has DRM content, the method returns a non-null<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.DrmInfo.html">MediaPlayer.DrmInfo</a></code>&nbsp;value.</li>
</ol>
<p style="text-align: justify;">If&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.DrmInfo.html">MediaPlayer.DrmInfo</a></code>&nbsp;exists:</p>
<ol style="text-align: justify;">
<li>Examine the map of available UUIDs and choose one.</li>
<li>Prepare the DRM configuration for the current source by calling&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>.</li>
<ul>
<li>If you created and registered an&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnDrmConfigHelper.html">OnDrmConfigHelper</a></code>&nbsp;callback, it is called while&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>&nbsp;is executing. This lets you perform custom configuration of the DRM properties before opening the DRM session. The callback is called synchronously in the thread that called&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>. To access the DRM properties, call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#getDrmPropertyString(java.lang.String)">getDrmPropertyString()</a></code>&nbsp;and&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#setDrmPropertyString(java.lang.String,%20java.lang.String)">setDrmPropertyString()</a></code>. Avoid performing lengthy operations.</li>
<li>If the device has not yet been provisioned,&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>&nbsp;also accesses the provisioning server to provision the device. This can take a variable amount of time, depending on the network connectivity.</li>
</ul>
<li>To get an opaque key request byte array to send to a license server, call&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#getKeyRequest(byte[],%20byte[],%20java.lang.String,%20int,%20java.util.Map%3Cjava.lang.String,%20java.lang.String%3E)">getKeyRequest()</a></code>.</li>
<li>To inform the DRM engine about the key response received from the license server, call<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#provideKeyResponse(byte[],%20byte[])">provideKeyResponse()</a></code>. The result depends on the type of key request:
<ul>
<li>If the response is for an offline key request, the result is a key-set identifier. You can use this key-set identifier with&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#restoreKeys(byte[])">restoreKeys()</a></code>&nbsp;to restore the keys to a new session.</li>
<li>If the response is for a streaming or release request, the result is null.</li>
</ul>
</li>
</ol>
<h3 id="running-preparedrm-asynchronously" style="text-align: justify;">Running&nbsp;<code dir="ltr" translate="no">prepareDrm()</code>&nbsp;asynchronously<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">By default,&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>&nbsp;runs synchronously, blocking until preparation is finished. However, the very first DRM preparation on a new device may also require provisioning, which is handled internally by&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>, and may take some time to finish due to the network operation involved. You can avoid blocking on<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>&nbsp;by defining and setting a&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnDrmPreparedListener.html">MediaPlayer.OnDrmPreparedListener</a></code>.</p>
<p style="text-align: justify;">When you set an&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnDrmPreparedListener.html">OnDrmPreparedListener</a></code>,&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>&nbsp;performs the provisioning (if needed) and preparation in the background. When provisioning and preparation have finished, the listener is called. You should not make any assumption about the calling sequence or the thread in which the listener runs (unless the listener is registered with a handler thread). The listener can be called before or after&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareDrm(java.util.UUID)">prepareDrm()</a></code>&nbsp;returns.</p>
<h3 id="setting-up-drm-asynchronously" style="text-align: justify;">Setting up DRM asynchronously<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h3>
<p style="text-align: justify;">You can initialize the DRM asynchronously by creating and registering the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnDrmInfoListener.html">MediaPlayer.OnDrmInfoListener</a></code>for DRM preparation and the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.OnDrmPreparedListener.html">MediaPlayer.OnDrmPreparedListener</a></code>&nbsp;to start the player. They work in conjunction with&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()">prepareAsync()</a></code>, as shown below:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="pln">setOnPreparedListener</span><span class="pun">();</span><span class="pln"><br />setOnDrmInfoListener</span><span class="pun">();</span><span class="pln"><br />setDataSource</span><span class="pun">();</span><span class="pln"><br />prepareAsync</span><span class="pun">();</span><span class="pln"><br /></span><span class="com">// ...</span><span class="pln"><br /><br /></span><span class="pln">onDrmInfo</span><span class="pun">()</span> <span class="pun">{</span><span class="pln"><br />&nbsp; prepareDrm</span><span class="pun">();</span><span class="pln"><br />&nbsp; getKeyRequest</span><span class="pun">();</span><span class="pln"><br />&nbsp; provideKeyResponse</span><span class="pun">();</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /><br /></span><span class="com">// When prepareAsync() finishes, you receive a call to the <br />onPrepared() callback.</span><span class="pln"><br /></span><span class="com">// If there is a DRM, onDrmInfo() sets it up before executing <br />this callback,</span><span class="pln"><br /></span><span class="com">// so you can start the player.</span><span class="pln"><br />onPrepared</span><span class="pun">()</span> <span class="pun">{</span><span class="pln"><br /><br />start</span><span class="pun">();</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<h2 id="encryption" style="text-align: justify;">Handling encrypted media<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h2>
<p style="text-align: justify;">Starting with Android 8.0 (API level 26)&nbsp;<code dir="ltr" translate="no">MediaPlayer</code>&nbsp;can also decrypt Common Encryption Scheme (CENC) and HLS sample-level encrypted media (METHOD=SAMPLE-AES) for the elementary stream types H.264, and AAC. Full-segment encrypted media (METHOD=AES-128) was previously supported.</p>
<h2 id="viacontentresolver" style="text-align: justify;">Retrieving media from a ContentResolver<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h2>
<p style="text-align: justify;">Another feature that may be useful in a media player application is the ability to retrieve music that the user has on the device. You can do that by querying the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/content/ContentResolver.html">ContentResolver</a></code>&nbsp;for external media:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="typ">ContentResolver</span><span class="pln"> contentResolver </span><span class="pun">=</span><span class="pln"> getContentResolver</span><span class="pun">();</span><span class="pln"><br /></span><span class="typ">Uri</span><span class="pln"> uri </span><span class="pun">=</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="typ">MediaStore</span><span class="pun">.</span><span class="typ">Audio</span><span class="pun">.</span><span class="typ">Media</span><span class="pun">.</span><span class="pln">EXTERNAL_CONTENT_URI</span><span class="pun">;</span><span class="pln"><br /></span><span class="typ">Cursor</span><span class="pln"> cursor </span><span class="pun">=</span><span class="pln"> contentResolver</span><span class="pun">.</span><span class="pln">query</span><span class="pun">(</span><span class="pln">uri</span><span class="pun">,</span> <span class="kwd">null</span><span class="pun">,</span> <span class="kwd">null</span><span class="pun">,</span> <span class="kwd">null</span><span class="pun">,</span> <span class="kwd">null</span><span class="pun">);</span><span class="pln"><br /></span><span class="kwd">if</span> <span class="pun">(</span><span class="pln">cursor </span><span class="pun">==</span> <span class="kwd">null</span><span class="pun">)</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// query failed, handle error.</span><span class="pln"><br /></span><span class="pun">}</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="pun">(!</span><span class="pln">cursor</span><span class="pun">.</span><span class="pln">moveToFirst</span><span class="pun">())</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="com">// no media on the device</span><span class="pln"><br /></span><span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> titleColumn </span><span class="pun">=</span><span class="pln"> cursor</span><span class="pun">.</span><span class="pln">getColumnIndex</span><span class="pun">(</span><span class="pln">android</span><span class="pun">.</span><span class="pln">provider<br /></span><span class="pun">   .</span><span class="typ">MediaStore</span><span class="pun">.</span><span class="typ">Audio</span><span class="pun">.</span><span class="typ">Media</span><span class="pun">.</span><span class="pln">TITLE</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> idColumn </span><span class="pun">=</span><span class="pln"> cursor</span><span class="pun">.</span><span class="pln">getColumnIndex</span><span class="pun">(</span><span class="pln">android</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.<br /></span><span class="typ">    MediaStore</span><span class="pun">.</span><span class="typ">Audio</span><span class="pun">.</span><span class="typ">Media</span><span class="pun">.</span><span class="pln">_ID</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">do</span> <span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">long</span><span class="pln"> thisId </span><span class="pun">=</span><span class="pln"> cursor</span><span class="pun">.</span><span class="pln">getLong</span><span class="pun">(</span><span class="pln">idColumn</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">String</span><span class="pln"> thisTitle </span><span class="pun">=</span><span class="pln"> cursor</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="pln">titleColumn</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// ...process entry...</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span> <span class="kwd">while</span> <span class="pun">(</span><span class="pln">cursor</span><span class="pun">.</span><span class="pln">moveToNext</span><span class="pun">());</span><span class="pln"><br /></span><span class="pun">}</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<p style="text-align: justify;">To use this with the&nbsp;<code dir="ltr" translate="no"><a href="https://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>, you can do this:</p>
<div style="text-align: justify;">
<div class="devsite-tabs-wrapper"><a href="https://developer.android.com/guide/topics/media/mediaplayer#kotlin">KOTLIN</a><a href="https://developer.android.com/guide/topics/media/mediaplayer#java">JAVA</a></div>
<section tabindex="0" role="tabpanel">
<pre class="lang-java" dir="ltr" translate="no"><span class="kwd">long</span><span class="pln"> id </span><span class="pun">=</span> <span class="com">/* retrieve it from somewhere */</span><span class="pun">;</span><span class="pln"><br /></span><span class="typ">Uri</span><span class="pln"> contentUri </span><span class="pun">=</span> <span class="typ">ContentUris</span><span class="pun">.</span><span class="pln">withAppendedId</span><span class="pun">(</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; android</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="typ">MediaStore</span><span class="pun">.</span><span class="typ">Audio</span><span class="pun">.</span><span class="typ">Media</span><span class="pun">.<br /></span><span class="pln">        EXTERNAL_CONTENT_URI</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">);</span><span class="pln"><br /><br />mediaPlayer </span><span class="pun">=</span> <span class="kwd">new</span> <span class="typ">MediaPlayer</span><span class="pun">();</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">setAudioStreamType</span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">);</span><span class="pln"><br />mediaPlayer</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> contentUri</span><span class="pun">);</span><span class="pln"><br /><br /></span><span class="com">// ...prepare and start...</span><span class="pln"><br /></span></pre>
<div class="devsite-code-buttons-container">&nbsp;</div>
</section>
</div>
<h2 id="sample-code" style="text-align: justify;">Sample code<button class="devsite-heading-link button-flat material-icons" role="button" data-title="Copy link to this section"></button></h2>
<p style="text-align: justify;">The&nbsp;<a href="https://github.com/googlesamples/android-SimpleMediaPlayer/">android- SimpleMediaPlayer</a>&nbsp;code sample shows how to build a stand-alone player. The&nbsp;<a href="https://github.com/googlesamples/android-BasicMediaDecoder/">android-BasicMediaDecoder</a>&nbsp;and&nbsp;<a href="https://github.com/googlesamples/android-DeviceOwner/">android-DeviceOwner</a>&nbsp;samples further demonstrate the use of the APIs covered on this page.</p>
</div>
</div>